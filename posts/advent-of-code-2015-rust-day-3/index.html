<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.5.1"><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Learning Rust with Advent of Code - Day 3" /><meta name="author" content="David & Felipe" /><meta property="og:locale" content="en_US" /><meta name="description" content="2015 Day 3: Follow cardinal directions to travel through a 2D grid with either one or two agents, and count all the grid positions visited at least once. Includes forays into structs and add-assign." /><meta property="og:description" content="2015 Day 3: Follow cardinal directions to travel through a 2D grid with either one or two agents, and count all the grid positions visited at least once. Includes forays into structs and add-assign." /><link rel="canonical" href="http://hallofdreams.org/posts/advent-of-code-2015-rust-day-3/" /><meta property="og:url" content="http://hallofdreams.org/posts/advent-of-code-2015-rust-day-3/" /><meta property="og:site_name" content="Hall of Impossible Dreams" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-28T12:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Learning Rust with Advent of Code - Day 3" /><meta name="twitter:site" content="@thecog19" /><meta name="twitter:creator" content="@David & Felipe" /><meta name="google-site-verification" content="rOMa9oYHtFBq7U58IniOX1gggI6noWpOXoWBk-9hItk" /> <script type="application/ld+json"> {"description":"2015 Day 3: Follow cardinal directions to travel through a 2D grid with either one or two agents, and count all the grid positions visited at least once. Includes forays into structs and add-assign.","@type":"BlogPosting","headline":"Learning Rust with Advent of Code - Day 3","url":"http://hallofdreams.org/posts/advent-of-code-2015-rust-day-3/","dateModified":"2021-01-28T12:00:00-05:00","datePublished":"2021-01-28T12:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://hallofdreams.org/posts/advent-of-code-2015-rust-day-3/"},"author":{"@type":"Person","name":"David & Felipe"},"@context":"https://schema.org"}</script><title>Learning Rust with Advent of Code - Day 3 | Hall of Impossible Dreams</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script async src="https://www.googletagmanager.com/gtag/js?id=G-QGYEJ40C64"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-QGYEJ40C64'); </script> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Hall of Impossible Dreams</a></div><div class="site-subtitle font-italic">A repository of code, fiction, nonfiction, and poetry.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/hallofdreams" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/thecog19" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['felipe.suero19','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Learning Rust with Advent of Code - Day 3</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Learning Rust with Advent of Code - Day 3</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Jan 28, 2021, 12:00 PM -0500" > Jan 28, 2021 <i class="unloaded">2021-01-28T12:00:00-05:00</i> </span> <span class="author"> by David & Felipe </span></div></div><div class="post-content"><h3>Series Navigation</h3><li><a href="/posts/advent-of-code-2015-rust-day-1/">Learning Rust with Advent of Code - Day 1</a><li><a href="/posts/advent-of-code-2015-rust-day-2/">Learning Rust with Advent of Code - Day 2</a><li><b>Learning Rust with Advent of Code - Day 3</b><li><a href="/posts/advent-of-code-2015-rust-day-4/">Learning Rust with Advent of Code - Day 4</a><li><a href="/posts/advent-of-code-2015-rust-day-5/">Learning Rust with Advent of Code - Day 5</a><li><a href="/posts/advent-of-code-2015-rust-day-6/">Learning Rust with Advent of Code - Day 6</a></div><hr><div class="post-content"><div style="display:none;">2015 Day 3: Follow cardinal directions to travel through a 2D grid with either one or two agents, and count all the grid positions visited at least once. Includes forays into structs and add-assign.</div><h1 id="day-3"><a href="https://adventofcode.com/2015/day/3">Day 3</a></h1><p>The problem: you’re given a number of one-character cardinal directions, with <code class="language-plaintext highlighter-rouge">^</code> representing <code class="language-plaintext highlighter-rouge">north</code>, <code class="language-plaintext highlighter-rouge">v</code> representing <code class="language-plaintext highlighter-rouge">south</code>, <code class="language-plaintext highlighter-rouge">&gt;</code> representing <code class="language-plaintext highlighter-rouge">east</code>, and <code class="language-plaintext highlighter-rouge">&lt;</code> representing <code class="language-plaintext highlighter-rouge">west</code>.</p><p>Part 1: Starting at <code class="language-plaintext highlighter-rouge">0,0</code>, find how many grid positions are visited at least once by an agent following all directions.</p><p>Part 2: Starting at <code class="language-plaintext highlighter-rouge">0,0</code>, find how many grid positions are visited at least once by either of two agents, who take turns following all directions.</p><hr /><h1 id="david">David</h1><p>This problem will be a bit harder than the previous one to run fast, but it shouldn’t be too hard to at least get a slow solution going. The pure brute-force way would be to create a 2D array of booleans, all initialized with <code class="language-plaintext highlighter-rouge">false</code>, but that feels like the obviously inefficient way to do it, so I’m going to use a <code class="language-plaintext highlighter-rouge">HashMap</code> instead, along with a counter variable.</p><p>First things first, let’s make the framework for the direction-parsing, that the rest of the code will be built off.</p><h2 id="attempt-00">Attempt 0.0</h2><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">fs</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">file</span> <span class="o">=</span> <span class="s">"../Inputs/Day3Input.txt"</span><span class="p">;</span>
	<span class="k">let</span> <span class="n">input_raw</span><span class="p">:</span> <span class="nb">String</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
	
	<span class="k">let</span> <span class="n">dir_indices</span> <span class="o">=</span> <span class="n">input_raw</span><span class="nf">.chars</span><span class="p">();</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">y</span><span class="p">:</span> <span class="nb">isize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="n">direction</span> <span class="k">in</span> <span class="n">dir_indices</span> <span class="p">{</span>
		<span class="k">let</span> <span class="n">increment</span> <span class="o">=</span> <span class="k">match</span> <span class="n">direction</span> <span class="p">{</span>
			<span class="sc">'^'</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
			<span class="sc">'v'</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
			<span class="sc">'&lt;'</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
			<span class="sc">'&gt;'</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
			<span class="n">_</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
		<span class="p">};</span>
		<span class="n">x</span> <span class="o">+=</span> <span class="n">increment</span><span class="na">.0</span><span class="p">;</span>
		<span class="n">y</span> <span class="o">+=</span> <span class="n">increment</span><span class="na">.1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nd">println!</span><span class="p">(</span><span class="s">"Current position: {}, {}"</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>Finished dev [unoptimized + debuginfo] target(s) in 0.22s
 Running `target/debug/day_3`

Current position: -95, -41
</pre></table></code></div></div><p>No error messages yet, because this is all stuff we’ve done before. Now we need to add the <code class="language-plaintext highlighter-rouge">HashMap</code>; I’ll try turning <code class="language-plaintext highlighter-rouge">x</code> and <code class="language-plaintext highlighter-rouge">y</code> into a string, concatenating them with a comma in between, and then using the resulting string as a key.</p><h2 id="attempt-01">Attempt 0.1</h2><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">fs</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::</span><span class="n">HashMap</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">file</span> <span class="o">=</span> <span class="s">"../Inputs/Day3Input.txt"</span><span class="p">;</span>
	<span class="k">let</span> <span class="n">input_raw</span><span class="p">:</span> <span class="nb">String</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
	
	<span class="k">let</span> <span class="n">dir_indices</span> <span class="o">=</span> <span class="n">input_raw</span><span class="nf">.chars</span><span class="p">();</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">y</span><span class="p">:</span> <span class="nb">isize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	
	<span class="k">let</span> <span class="k">mut</span> <span class="n">santa_1</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">part1</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	
	<span class="k">for</span> <span class="n">direction</span> <span class="k">in</span> <span class="n">dir_indices</span> <span class="p">{</span>
		<span class="k">let</span> <span class="n">increment</span> <span class="o">=</span> <span class="k">match</span> <span class="n">direction</span> <span class="p">{</span>
			<span class="sc">'^'</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
			<span class="sc">'v'</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
			<span class="sc">'&lt;'</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
			<span class="sc">'&gt;'</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
			<span class="n">_</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
		<span class="p">};</span>
		<span class="n">x</span> <span class="o">+=</span> <span class="n">increment</span><span class="na">.0</span><span class="p">;</span>
		<span class="n">y</span> <span class="o">+=</span> <span class="n">increment</span><span class="na">.1</span><span class="p">;</span>
		<span class="k">let</span> <span class="n">k</span> <span class="o">=</span> <span class="nd">concat!</span><span class="p">(</span><span class="n">x</span><span class="nf">.to_string</span><span class="p">(),</span> <span class="s">","</span><span class="p">,</span> <span class="n">y</span><span class="nf">.to_string</span><span class="p">());</span>
		<span class="k">if</span> <span class="o">!</span><span class="n">santa_1</span><span class="nf">.contains_key</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">santa_1</span><span class="nf">.insert</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="k">true</span><span class="p">);</span>
			<span class="n">part1</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">};</span>
	<span class="p">}</span>
	<span class="nd">println!</span><span class="p">(</span><span class="s">"Part 1: {}"</span><span class="p">,</span><span class="n">part1</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>error: expected a literal

let k = concat!(x.to_string(), ",", y.to_string());
                ^^^^^^^^^^^^^       ^^^^^^^^^^^^^
= note: only literals (like `"foo"`, `42` and `3.14`) can be passed to `concat!()`
</pre></table></code></div></div><p>Now that’s interesting. I figured that <code class="language-plaintext highlighter-rouge">.to_string()</code> would convert to a string, which it does, but it apparently does <em>not</em> convert to a string literal. I don’t know the difference between those two things, but <a href="https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html#the-string-type">the documentation</a> says that string literals are immutable and stored inside the binary (such as my <code class="language-plaintext highlighter-rouge">println!()</code> statement at the end), while Strings are mutable and created within the program, and their contents are not known at compile time. I know that functions like <code class="language-plaintext highlighter-rouge">println!()</code> can create new strings from integers on the fly, so poking around, I see that <code class="language-plaintext highlighter-rouge">display()</code> does the same thing without printing the result, but saving it as a <code class="language-plaintext highlighter-rouge">String</code>.</p><h2 id="attempt-02">Attempt 0.2</h2><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">fs</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::</span><span class="n">HashMap</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">file</span> <span class="o">=</span> <span class="s">"../Inputs/Day3Input.txt"</span><span class="p">;</span>
	<span class="k">let</span> <span class="n">input_raw</span><span class="p">:</span> <span class="nb">String</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
	
	<span class="k">let</span> <span class="n">dir_indices</span> <span class="o">=</span> <span class="n">input_raw</span><span class="nf">.chars</span><span class="p">();</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">y</span><span class="p">:</span> <span class="nb">isize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	
	<span class="k">let</span> <span class="k">mut</span> <span class="n">santa_1</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">part1</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	
	<span class="k">for</span> <span class="n">direction</span> <span class="k">in</span> <span class="n">dir_indices</span> <span class="p">{</span>
		<span class="k">let</span> <span class="n">increment</span> <span class="o">=</span> <span class="k">match</span> <span class="n">direction</span> <span class="p">{</span>
			<span class="sc">'^'</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
			<span class="sc">'v'</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
			<span class="sc">'&lt;'</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
			<span class="sc">'&gt;'</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
			<span class="n">_</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
		<span class="p">};</span>
		<span class="n">x</span> <span class="o">+=</span> <span class="n">increment</span><span class="na">.0</span><span class="p">;</span>
		<span class="n">y</span> <span class="o">+=</span> <span class="n">increment</span><span class="na">.1</span><span class="p">;</span>
		<span class="k">let</span> <span class="n">k</span> <span class="o">=</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"{},{}"</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
		<span class="k">if</span> <span class="o">!</span><span class="n">santa_1</span><span class="nf">.contains_key</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">santa_1</span><span class="nf">.insert</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="k">true</span><span class="p">);</span>
			<span class="n">part1</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">};</span>
	<span class="p">}</span>
	<span class="nd">println!</span><span class="p">(</span><span class="s">"Part 1: {}"</span><span class="p">,</span><span class="n">part1</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>error[E0308]: mismatched types

if !santa_1.contains_key(k) {
                         ^
                         |
                         expected reference, found struct `String`
                         help: consider borrowing here: `&amp;k`
= note: expected reference `&amp;_`
              found struct `String`
</pre></table></code></div></div><p>This is one of the most helpful error messages I’ve seen yet, as it directly tells me what to do to fix the problem: replace <code class="language-plaintext highlighter-rouge">.contains_key(k)</code> with <code class="language-plaintext highlighter-rouge">.contains_key(&amp;k)</code>. But before I do that, I want to understand <em>why</em>. From the error message, it’s clear that <code class="language-plaintext highlighter-rouge">.insert()</code> expects a reference, not a <code class="language-plaintext highlighter-rouge">String</code>, but <a href="https://doc.rust-lang.org/beta/std/collections/struct.HashMap.html">the documentation for <code class="language-plaintext highlighter-rouge">HashMap</code></a> doesn’t explicitly say this; in fact, it doesn’t even say that keys have to be strings, just that keys have to implement the <code class="language-plaintext highlighter-rouge">Eq</code> and <code class="language-plaintext highlighter-rouge">Hash</code> traits. My guess, for now, is that equality is checked by means of references and not string values, but I’m unclear on that. Still, that gives me enough to finish off the problem.</p><h2 id="attempt-03">Attempt 0.3</h2><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">fs</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::</span><span class="n">HashMap</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">time</span><span class="p">::{</span><span class="n">Instant</span><span class="p">};</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">let</span> <span class="n">start</span> <span class="o">=</span> <span class="nn">Instant</span><span class="p">::</span><span class="nf">now</span><span class="p">();</span>
	
    <span class="k">let</span> <span class="n">file</span> <span class="o">=</span> <span class="s">"../Inputs/Day3Input.txt"</span><span class="p">;</span>
	<span class="k">let</span> <span class="n">input_raw</span><span class="p">:</span> <span class="nb">String</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
	
	<span class="k">let</span> <span class="n">dir_indices</span> <span class="o">=</span> <span class="n">input_raw</span><span class="nf">.chars</span><span class="p">();</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">x1</span><span class="p">:</span> <span class="nb">isize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">y1</span><span class="p">:</span> <span class="nb">isize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">x2a</span><span class="p">:</span> <span class="nb">isize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">y2a</span><span class="p">:</span> <span class="nb">isize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">x2b</span><span class="p">:</span> <span class="nb">isize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">y2b</span><span class="p">:</span> <span class="nb">isize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	
	<span class="k">let</span> <span class="k">mut</span> <span class="n">santa_1</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">santa_2</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">part1</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">part2</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">odd</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
	
	<span class="k">for</span> <span class="n">direction</span> <span class="k">in</span> <span class="n">dir_indices</span> <span class="p">{</span>
		<span class="k">let</span> <span class="n">increment</span> <span class="o">=</span> <span class="k">match</span> <span class="n">direction</span> <span class="p">{</span>
			<span class="sc">'^'</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
			<span class="sc">'v'</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
			<span class="sc">'&lt;'</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
			<span class="sc">'&gt;'</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
			<span class="n">_</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
		<span class="p">};</span>
		<span class="n">x1</span> <span class="o">+=</span> <span class="n">increment</span><span class="na">.0</span><span class="p">;</span>
		<span class="n">y1</span> <span class="o">+=</span> <span class="n">increment</span><span class="na">.1</span><span class="p">;</span>
		<span class="k">if</span> <span class="n">odd</span> <span class="p">{</span>
			<span class="n">x2a</span> <span class="o">+=</span> <span class="n">increment</span><span class="na">.0</span><span class="p">;</span>
			<span class="n">y2a</span> <span class="o">+=</span> <span class="n">increment</span><span class="na">.1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">x2b</span> <span class="o">+=</span> <span class="n">increment</span><span class="na">.0</span><span class="p">;</span>
			<span class="n">y2b</span> <span class="o">+=</span> <span class="n">increment</span><span class="na">.1</span><span class="p">;</span>
		<span class="p">};</span>
		
		<span class="k">let</span> <span class="n">k1</span> <span class="o">=</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"{},{}"</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">);</span>
		<span class="k">let</span> <span class="n">k2</span> <span class="o">=</span> <span class="k">match</span> <span class="n">odd</span> <span class="p">{</span>
			<span class="k">true</span> <span class="k">=&gt;</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"{},{}"</span><span class="p">,</span> <span class="n">x2a</span><span class="p">,</span> <span class="n">y2a</span><span class="p">),</span>
			<span class="k">false</span> <span class="k">=&gt;</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"{},{}"</span><span class="p">,</span> <span class="n">x2b</span><span class="p">,</span> <span class="n">y2b</span><span class="p">),</span>
		<span class="p">};</span>
		<span class="k">if</span> <span class="o">!</span><span class="n">santa_1</span><span class="nf">.contains_key</span><span class="p">(</span><span class="o">&amp;</span><span class="n">k1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">santa_1</span><span class="nf">.insert</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span><span class="k">true</span><span class="p">);</span>
			<span class="n">part1</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">};</span>
		<span class="k">if</span> <span class="o">!</span><span class="n">santa_2</span><span class="nf">.contains_key</span><span class="p">(</span><span class="o">&amp;</span><span class="n">k2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">santa_2</span><span class="nf">.insert</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span><span class="k">true</span><span class="p">);</span>
			<span class="n">part2</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">};</span>
		<span class="n">odd</span> <span class="o">=</span> <span class="o">!</span><span class="n">odd</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">let</span> <span class="n">end</span> <span class="o">=</span> <span class="n">start</span><span class="nf">.elapsed</span><span class="p">()</span><span class="nf">.as_micros</span><span class="p">();</span>
	
	<span class="nd">println!</span><span class="p">(</span><span class="s">"Part 1: {}"</span><span class="p">,</span><span class="n">part1</span><span class="p">);</span>
	<span class="nd">println!</span><span class="p">(</span><span class="s">"Part 2: {}"</span><span class="p">,</span><span class="n">part2</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"Time: {} μs"</span><span class="p">,</span> <span class="n">end</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>Finished release [optimized] target(s) in 0.41s
 Running `target/release/day_3`
Part 1: 2592
Part 2: 2360
Time: 1903 μs
</pre></table></code></div></div><p>Two more stars acquired, but I can’t say I’m satisfied with it. I have a lot of repetitive code, which my gut tells me should be compressible, and the code is very slow compared to the previous two days: almost 2 milliseconds, so only a factor of thirty-five times faster than my Mathematica code. I want to at least try to improve both of these shortcomings.</p><p>The first optimization that comes to mind is the <code class="language-plaintext highlighter-rouge">HashMap</code> initialization. The HashMap can’t possibly store more elements than there are characters in the file, so if I preallocate that many elements, it shouldn’t have to reallocate on the fly.</p><h2 id="attempt-10">Attempt 1.0</h2><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">fn</span> <span class="n">main</span> <span class="p">{</span>
<span class="o">...</span>
	<span class="k">let</span> <span class="n">metadata</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">metadata</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
	<span class="k">let</span> <span class="n">file_size</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="n">metadata</span><span class="nf">.len</span><span class="p">()</span><span class="nf">.try_into</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
<span class="o">...</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">santa_1</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">with_capacity</span><span class="p">(</span><span class="n">file_size</span><span class="p">);</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">santa_2</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">with_capacity</span><span class="p">(</span><span class="n">file_size</span><span class="p">);</span>
<span class="o">...</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>    Finished release [optimized] target(s) in 0.41s
     Running `target/release/day_3`
Part 1: 2592
Part 2: 2360
Time: 1880 μs
</pre></table></code></div></div><p>The code runs, and the preallocation works just fine, but there’s an improvement, it’s so small I can’t tell whether or not it actually exists at all.. My general intuition about what is and is not slowing down the code clearly isn’t enough: I need a Rust code profiler, and I’m going to use <a href="https://github.com/brendangregg/perf-tools"><code class="language-plaintext highlighter-rouge">perf</code></a> and <a href="https://github.com/flamegraph-rs/flamegraph"><code class="language-plaintext highlighter-rouge">flamegraph</code></a>; I won’t bother with more detailed benchmarking just yet, for the simple reason that if I need a detailed benchmark to see if there’s been an improvement, then I’m probably not looking at the order-of-magnitude improvements that I think should be possible for this program.</p><p>To install them (January 2021; this may be outdated), I used</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>sudo apt install linux-tools-common linux-tools-generic
cargo install flamebench
</pre></table></code></div></div><p>I ran the flamegraph with the (apparently) absurdly high sampling rate of 29.999 kHz, enough to get about a thousand samples.</p><p><a href="/assets/img/Rust_AoC_2015_Day_3_1_flamegraph.svg"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/Rust_AoC_2015_Day_3_1_flamegraph.svg" alt="Click to view annotated flamegraph" /></a></p><p>Unfortunately, this is as far as I was able to get. Clicking on that flamegraph and zooming into <code class="language-plaintext highlighter-rouge">day_3</code> (most of the rest was the <code class="language-plaintext highlighter-rouge">perf</code> profiler itself, which we of course can ignore), I see that a full 80% of the time was spent on <code class="language-plaintext highlighter-rouge">core::ops::function::impls::&lt;impl core::ops::function::FnOnce&lt;A&gt; for &amp;F&gt;::call_once</code> - which, if I understand it, is a function called once and not one of the functions in my loop. <code class="language-plaintext highlighter-rouge">main</code>, if I had to guess. And the breakdown simply doesn’t display most of what that <code class="language-plaintext highlighter-rouge">call_once</code> function is actually doing; I suspect this profiler was designed for code that runs far slower and is far more intricate than mine. Running the same flamegraph for day 2 showed a similar percentage of time spent on that core function, so that’s not the problem, and I can’t get any deeper with the profiling capability I have.</p><h2 id="attempt-11">Attempt 1.1</h2><p>So, I’m going to continue on with at least cleaning the code up, even if I can’t speed it up. The first thing to do is trim down all those coordinates, preferably into some kind of structure that lets me</p><ul><li>Test for equality (for the <code class="language-plaintext highlighter-rouge">HashMap</code>)<li>Compute a hash (for the <code class="language-plaintext highlighter-rouge">HashMap</code>)<li>Add two coordinate pairs together (for easier traversal)<li>Initialize with a specific value</ul><p>According to the documentation, the way to create a structure is with <a href="https://doc.rust-lang.org/rust-by-example/custom_types/structs.html"><code class="language-plaintext highlighter-rouge">struct</code></a> (which includes named tuples: perfect for this), and the way to implement equality tests, hashes, and addition is with either <a href="https://doc.rust-lang.org/rust-by-example/trait/impl_trait.html"><code class="language-plaintext highlighter-rouge">derive](https://doc.rust-lang.org/rust-by-example/trait/derive.html) or [</code>impl Trait`</a>.</p><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nd">#[derive(Hash,</span> <span class="nd">Eq,</span> <span class="nd">PartialEq)]</span>
<span class="k">struct</span> <span class="n">Coords</span> <span class="p">{</span>
	<span class="n">x</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
	<span class="n">y</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Finished release [optimized] target(s) in 1.13s
 Running `target/release/day_3`
</pre></table></code></div></div><p>So far, so good; I’ve derived <code class="language-plaintext highlighter-rouge">Hash</code> and <code class="language-plaintext highlighter-rouge">Eq</code>, and things are working well.</p><h2 id="attempt-12">Attempt 1.2</h2><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">ops</span><span class="p">::</span><span class="nb">Add</span><span class="p">;</span>

<span class="nd">#[derive(Hash,</span> <span class="nd">Eq,</span> <span class="nd">PartialEq)]</span>
<span class="k">struct</span> <span class="n">Coords</span> <span class="p">{</span>
	<span class="n">x</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
	<span class="n">y</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="nb">PartialEq</span> <span class="k">for</span> <span class="n">Coords</span> <span class="p">{</span>
	<span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
		<span class="k">self</span><span class="py">.x</span> <span class="o">==</span> <span class="n">other</span><span class="py">.x</span> <span class="o">&amp;&amp;</span> <span class="k">self</span><span class="py">.y</span> <span class="o">==</span> <span class="n">other</span><span class="py">.y</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="nb">Eq</span> <span class="k">for</span> <span class="n">Coords</span> <span class="p">{}</span>

<span class="k">impl</span> <span class="nb">Add</span> <span class="k">for</span> <span class="n">Coords</span> <span class="p">{</span>
	<span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
		<span class="k">Self</span> <span class="p">{</span>
			<span class="n">x</span><span class="p">:</span> <span class="k">self</span><span class="py">.x</span> <span class="o">+</span> <span class="n">other</span><span class="py">.x</span><span class="p">,</span>
			<span class="n">y</span><span class="p">:</span> <span class="k">self</span><span class="py">.y</span> <span class="o">+</span> <span class="n">other</span><span class="py">.y</span><span class="p">,</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>error[E0046]: not all trait items implemented, missing: `Output`

impl Add for Coords {
^^^^^^^^^^^^^^^^^^^ missing `Output` in implementation

= help: implement the missing item: `type Output = Type;`
</pre></table></code></div></div><p>Interestingly, it seems that unlike traits such as <code class="language-plaintext highlighter-rouge">Eq</code> (which return a <code class="language-plaintext highlighter-rouge">bool</code>), traits like <code class="language-plaintext highlighter-rouge">Add</code> specify an output type. The example given is how you can add <code class="language-plaintext highlighter-rouge">Duration</code> to <code class="language-plaintext highlighter-rouge">SystemTime</code> to get <code class="language-plaintext highlighter-rouge">SystemTime</code>; the possibility of adding two different structures together creates the necessity of specifying type, I suppose.</p><h2 id="attempt-13">Attempt 1.3</h2><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">ops</span><span class="p">::</span><span class="nb">Add</span><span class="p">;</span>

<span class="nd">#[derive(Hash,</span> <span class="nd">Eq,</span> <span class="nd">PartialEq)]</span>
<span class="k">struct</span> <span class="n">Coords</span> <span class="p">{</span>
	<span class="n">x</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
	<span class="n">y</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="nb">PartialEq</span> <span class="k">for</span> <span class="n">Coords</span> <span class="p">{</span>
	<span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
		<span class="k">self</span><span class="py">.x</span> <span class="o">==</span> <span class="n">other</span><span class="py">.x</span> <span class="o">&amp;&amp;</span> <span class="k">self</span><span class="py">.y</span> <span class="o">==</span> <span class="n">other</span><span class="py">.y</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="nb">Eq</span> <span class="k">for</span> <span class="n">Coords</span> <span class="p">{}</span>

<span class="k">impl</span> <span class="nb">Add</span> <span class="k">for</span> <span class="n">Coords</span> <span class="p">{</span>
	<span class="k">type</span> <span class="n">Output</span> <span class="o">=</span> <span class="n">Coords</span><span class="p">;</span>
	<span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
		<span class="k">Self</span> <span class="p">{</span>
			<span class="n">x</span><span class="p">:</span> <span class="k">self</span><span class="py">.x</span> <span class="o">+</span> <span class="n">other</span><span class="py">.x</span><span class="p">,</span>
			<span class="n">y</span><span class="p">:</span> <span class="k">self</span><span class="py">.y</span> <span class="o">+</span> <span class="n">other</span><span class="py">.y</span><span class="p">,</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>error[E0053]: method `add` has an incompatible type for trait

fn add(&amp;self, other: &amp;Self) -&gt; Self {
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected struct `Coords`, found `&amp;Coords`

= note: expected fn pointer `fn(Coords, Coords) -&gt; Coords`
           found fn pointer `fn(&amp;Coords, &amp;Coords) -&gt; Coords`
</pre></table></code></div></div><p>Reading the documentation for the <a href="https://doc.rust-lang.org/std/ops/trait.Add.html#tymethod.add"><code class="language-plaintext highlighter-rouge">Add</code> trait</a>, I saw that there was a method which was required: <code class="language-plaintext highlighter-rouge">fn add()</code>. And looking at it, I see that it takes structures, not references - there’s no <code class="language-plaintext highlighter-rouge">&amp;</code> in the whole function. But I don’t understand <em>why</em> it doesn’t take references; isn’t the whole point of a reference to point to something so that you don’t have to borrow it?</p><p>This is made especially confusing by the fact that equality function in the <a href="https://doc.rust-lang.org/std/cmp/trait.PartialEq.html#tymethod.eq"><code class="language-plaintext highlighter-rouge">PartialEq</code> trait</a> does, in fact, take references</p><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">Rhs</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span>
</pre></table></code></div></div><p>But at least, the compiler was helpful enough to tell me how to fix it.</p><h2 id="attempt-14">Attempt 1.4</h2><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">ops</span><span class="p">::</span><span class="nb">Add</span><span class="p">;</span>

<span class="nd">#[derive(Hash,</span> <span class="nd">Eq,</span> <span class="nd">PartialEq)]</span>
<span class="k">struct</span> <span class="n">Coords</span> <span class="p">{</span>
	<span class="n">x</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
	<span class="n">y</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="nb">PartialEq</span> <span class="k">for</span> <span class="n">Coords</span> <span class="p">{</span>
	<span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
		<span class="k">self</span><span class="py">.x</span> <span class="o">==</span> <span class="n">other</span><span class="py">.x</span> <span class="o">&amp;&amp;</span> <span class="k">self</span><span class="py">.y</span> <span class="o">==</span> <span class="n">other</span><span class="py">.y</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="nb">Eq</span> <span class="k">for</span> <span class="n">Coords</span> <span class="p">{}</span>

<span class="k">impl</span> <span class="nb">Add</span> <span class="k">for</span> <span class="n">Coords</span> <span class="p">{</span>
	<span class="k">type</span> <span class="n">Output</span> <span class="o">=</span> <span class="n">Coords</span><span class="p">;</span>
	<span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="k">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
		<span class="k">Self</span> <span class="p">{</span>
			<span class="n">x</span><span class="p">:</span> <span class="k">self</span><span class="py">.x</span> <span class="o">+</span> <span class="n">other</span><span class="py">.x</span><span class="p">,</span>
			<span class="n">y</span><span class="p">:</span> <span class="k">self</span><span class="py">.y</span> <span class="o">+</span> <span class="n">other</span><span class="py">.y</span><span class="p">,</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Finished release [optimized] target(s) in 0.41s
 Running `target/release/day_3`
</pre></table></code></div></div><p>Well, that should be everything. Time to put it into the main code.</p><h2 id="attempt-15">Attempt 1.5</h2><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">fn</span> <span class="n">main</span> <span class="p">{</span>
<span class="o">...</span>
		<span class="n">coords1</span> <span class="o">=</span> <span class="n">coords1</span> <span class="o">+</span> <span class="n">increment</span><span class="p">;</span>
<span class="o">...</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>error[E0382]: use of moved value: `coords1`
  --&gt; src/main.rs:50:13
   |
32 |     let mut coords1 = Coords{x:0,y:0};
   |         ----------- move occurs because `coords1` has type `Coords`, which does not implement the `Copy` trait
...
50 |         coords1 = coords1 + increment;
   |                   ^^^^^^^ value used here after move
...
62 |             santa_1.insert(coords1,true);
   |                            ------- value moved here, in previous iteration of loop

</pre></table></code></div></div><p>Oh, right - I completely forgot that <code class="language-plaintext highlighter-rouge">Copy</code> was a trait that the coordinates need to have. I’ll add that, of course, but that makes me think: how much copying and cloning is going on here? Could I simplify things a bit by also adding in the <code class="language-plaintext highlighter-rouge">AddAssign</code> trait? Most of what I’m doing with the coordinates is changing them, not creating new ones, so I may as well not be wasteful.</p><p>Looking at the <a href="https://doc.rust-lang.org/std/ops/trait.AddAssign.html"><code class="language-plaintext highlighter-rouge">AddAssign</code> trait</a> documentation, it seems that there is no requirement for an output type (which makes sense - the output type has to be the type on the left-hand side), that the left-hand side must be mutable (also makes sense), and that the syntax is otherwise the same, with the single exception of</p><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>        <span class="o">*</span><span class="k">self</span> <span class="o">=</span> <span class="k">Self</span> <span class="p">{</span>
</pre></table></code></div></div><p>instead of</p><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>        <span class="k">Self</span> <span class="p">{</span>
</pre></table></code></div></div><p>I hadn’t seen the <code class="language-plaintext highlighter-rouge">*</code> operator before, but it seems to be a dereferencer: you pass in a reference, and <code class="language-plaintext highlighter-rouge">*</code> allows access to the referenced-to value. Interesting. At any rate, shouldn’t be hard to make, so let’s finally put everything together</p><h2 id="final-version">Final Version</h2><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">fs</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::</span><span class="n">HashMap</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">time</span><span class="p">::{</span><span class="n">Instant</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">convert</span><span class="p">::</span><span class="n">TryInto</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">ops</span><span class="p">::{</span><span class="nb">Add</span><span class="p">,</span><span class="n">AddAssign</span><span class="p">};</span>

<span class="nd">#[derive(Hash,</span> <span class="nd">PartialEq,</span> <span class="nd">Eq,</span> <span class="nd">Copy,</span> <span class="nd">Clone)]</span>
<span class="k">struct</span> <span class="n">Coords</span> <span class="p">{</span>
	<span class="n">x</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
	<span class="n">y</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="nb">Add</span> <span class="k">for</span> <span class="n">Coords</span> <span class="p">{</span>
	<span class="k">type</span> <span class="n">Output</span> <span class="o">=</span> <span class="n">Coords</span><span class="p">;</span>
	<span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="k">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
		<span class="k">Self</span> <span class="p">{</span>
			<span class="n">x</span><span class="p">:</span> <span class="k">self</span><span class="py">.x</span> <span class="o">+</span> <span class="n">other</span><span class="py">.x</span><span class="p">,</span>
			<span class="n">y</span><span class="p">:</span> <span class="k">self</span><span class="py">.y</span> <span class="o">+</span> <span class="n">other</span><span class="py">.y</span><span class="p">,</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">AddAssign</span> <span class="k">for</span> <span class="n">Coords</span> <span class="p">{</span>
	<span class="k">fn</span> <span class="nf">add_assign</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="k">Self</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">*</span><span class="k">self</span> <span class="o">=</span> <span class="k">Self</span> <span class="p">{</span>
			<span class="n">x</span><span class="p">:</span> <span class="k">self</span><span class="py">.x</span> <span class="o">+</span> <span class="n">other</span><span class="py">.x</span><span class="p">,</span>
			<span class="n">y</span><span class="p">:</span> <span class="k">self</span><span class="py">.y</span> <span class="o">+</span> <span class="n">other</span><span class="py">.y</span><span class="p">,</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">let</span> <span class="n">start</span> <span class="o">=</span> <span class="nn">Instant</span><span class="p">::</span><span class="nf">now</span><span class="p">();</span>
	
    <span class="k">let</span> <span class="n">file</span> <span class="o">=</span> <span class="s">"../Inputs/Day3Input.txt"</span><span class="p">;</span>
	<span class="k">let</span> <span class="n">input_raw</span><span class="p">:</span> <span class="nb">String</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
	<span class="k">let</span> <span class="n">metadata</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">metadata</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
	<span class="k">let</span> <span class="n">file_size</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="n">metadata</span><span class="nf">.len</span><span class="p">()</span><span class="nf">.try_into</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
	
	<span class="k">let</span> <span class="n">dir_indices</span> <span class="o">=</span> <span class="n">input_raw</span><span class="nf">.chars</span><span class="p">();</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">coords1</span> <span class="o">=</span> <span class="n">Coords</span><span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="mi">0</span><span class="p">};</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">coords2a</span> <span class="o">=</span> <span class="n">Coords</span><span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="mi">0</span><span class="p">};</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">coords2b</span> <span class="o">=</span> <span class="n">Coords</span><span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="mi">0</span><span class="p">};</span>
	
	<span class="k">let</span> <span class="k">mut</span> <span class="n">santa_1</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">with_capacity</span><span class="p">(</span><span class="n">file_size</span><span class="p">);</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">santa_2</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">with_capacity</span><span class="p">(</span><span class="n">file_size</span><span class="p">);</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">part1</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">part2</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">let</span> <span class="k">mut</span> <span class="n">odd</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
	
	<span class="k">for</span> <span class="n">direction</span> <span class="k">in</span> <span class="n">dir_indices</span> <span class="p">{</span>
		<span class="k">let</span> <span class="n">increment</span> <span class="o">=</span> <span class="k">match</span> <span class="n">direction</span> <span class="p">{</span>
			<span class="sc">'^'</span> <span class="k">=&gt;</span> <span class="n">Coords</span><span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span>
			<span class="sc">'v'</span> <span class="k">=&gt;</span> <span class="n">Coords</span><span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span>
			<span class="sc">'&lt;'</span> <span class="k">=&gt;</span> <span class="n">Coords</span><span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
			<span class="sc">'&gt;'</span> <span class="k">=&gt;</span> <span class="n">Coords</span><span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">},</span>
			<span class="n">_</span> <span class="k">=&gt;</span> <span class="n">Coords</span><span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span>
		<span class="p">};</span>
		<span class="n">coords1</span> <span class="o">+=</span> <span class="n">increment</span><span class="p">;</span>
		<span class="k">if</span> <span class="n">odd</span> <span class="p">{</span>
			<span class="n">coords2a</span> <span class="o">+=</span> <span class="n">increment</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">coords2b</span> <span class="o">+=</span> <span class="n">increment</span><span class="p">;</span>
		<span class="p">};</span>
		
		<span class="k">if</span> <span class="o">!</span><span class="n">santa_1</span><span class="nf">.contains_key</span><span class="p">(</span><span class="o">&amp;</span><span class="n">coords1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">santa_1</span><span class="nf">.insert</span><span class="p">(</span><span class="n">coords1</span><span class="p">,</span><span class="k">true</span><span class="p">);</span>
			<span class="n">part1</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">};</span>
		<span class="k">if</span> <span class="n">odd</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">santa_2</span><span class="nf">.contains_key</span><span class="p">(</span><span class="o">&amp;</span><span class="n">coords2a</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">santa_2</span><span class="nf">.insert</span><span class="p">(</span><span class="n">coords2a</span><span class="p">,</span><span class="k">true</span><span class="p">);</span>
			<span class="n">part2</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">};</span>
		<span class="k">if</span> <span class="o">!</span><span class="n">odd</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">santa_2</span><span class="nf">.contains_key</span><span class="p">(</span><span class="o">&amp;</span><span class="n">coords2b</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">santa_2</span><span class="nf">.insert</span><span class="p">(</span><span class="n">coords2b</span><span class="p">,</span><span class="k">true</span><span class="p">);</span>
			<span class="n">part2</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">};</span>
		<span class="n">odd</span> <span class="o">=</span> <span class="o">!</span><span class="n">odd</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">let</span> <span class="n">end</span> <span class="o">=</span> <span class="n">start</span><span class="nf">.elapsed</span><span class="p">()</span><span class="nf">.as_micros</span><span class="p">();</span>
	
	<span class="nd">println!</span><span class="p">(</span><span class="s">"Part 1: {}"</span><span class="p">,</span><span class="n">part1</span><span class="p">);</span>
	<span class="nd">println!</span><span class="p">(</span><span class="s">"Part 2: {}"</span><span class="p">,</span><span class="n">part2</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"Time: {} μs"</span><span class="p">,</span> <span class="n">end</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>Finished release [optimized] target(s) in 0.39s
 Running `target/release/day_3`
Part 1: 2592
Part 2: 2360
Time: 725 μs
</pre></table></code></div></div><p>Not only do we still get the correct answer, but the code is much more readable (if longer), and it runs in only a third of the time! My Mathematica code ran in 70 ms, so this is an improvement by a factor of 100. I’ll call this a success.</p><p>So why did it run so much faster? My guess is that a lot of it came down to the <code class="language-plaintext highlighter-rouge">Hash</code> function. Because I <code class="language-plaintext highlighter-rouge">derive</code>d <code class="language-plaintext highlighter-rouge">Hash</code> on the tuple itself rather than generating a new string with <code class="language-plaintext highlighter-rouge">format()</code>, I suspect the built-in methods were much faster than my ad-hoc solution. Which is a good lesson for future problems: if built-ins exist, use them.</p><p>Coordinates are something which will come up again, and next time they do, I’ll figure out how to make a utilities <code class="language-plaintext highlighter-rouge">crate</code> to put my <code class="language-plaintext highlighter-rouge">Coords</code> structure in, along with other structures that I’m sure I’ll find useful over the course of the month.</p><h1 id="felipe">Felipe</h1><p>I promised we’d use datastructures wrong today, and while I didn’t go <em>quite</em> as far as I planned to on that front, we still do some interesting things.</p><p>The problem, as you already know is about Santa visiting houses and keeping track of which houses have been visited. If you’ve ever done software interviews, you’ve run into a variation of this problem… letter counting. The way the problem is usually phrased as “Write a program, that given an arbitrary string, will return which letter appears the most frequently.” It doesn’t <em>sound</em> anything like this problem, but its foundationally the same. It requires you to iterate over a string and keep a ledger of some kind tracking the results of each character in the string. If you’re <em>not</em> super familiar with software, you probably imagined you have to build a map using a 2D array, and keep track of the position of the Santa, and flatten that… but you really don’t.</p><p>What matters here is</p><ol><li>Tracking the location of Santa<li>Tracking houses that have been visited</ol><p>You <em>can</em> do that by drawing a map, but its a miserable exercise. You can also acomplish that by having a coordinate pair that tells you where Santa is, and a HashMap that keeps track of visited coordinates. The arguments in favor of the HashMap are many, namely we’ll be looking at a really fast read and write time (O(1) write, read and insert times, except if we have to rebalance the buckets, which shouldn’t happen frequently).</p><p>Visualizing what this code will look like, we can imagine we’ll make a HashMap to store the coordinates we’ve visited, we’ll have a pair of coordinates to know where Santa is, and we’ll have an iterator that will parse the string of moves. P2 just requires us to alternate between two Santas, which we can do by tracking if our current move is odd or even. We could have a bool we flip, or increment a counter, or anything really as long as it consistently swaps moves.</p><p>Thus our V1 of the code looks something like this:</p><h2 id="initial-version">Initial Version</h2><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">time</span><span class="p">::{</span><span class="n">Instant</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">fs</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::</span><span class="n">HashMap</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">(){</span>
       
        <span class="k">let</span> <span class="n">file</span> <span class="o">=</span><span class="s">"../input.txt"</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">input_string</span><span class="p">:</span> <span class="nb">String</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">start</span> <span class="o">=</span> <span class="nn">Instant</span><span class="p">::</span><span class="nf">now</span><span class="p">();</span>
  
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_1_x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_2_x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_3_x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_1_y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_2_y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_3_y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">curr_turn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">visited_santa_1</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">visited_other_santas</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

        <span class="n">visited_santa_1</span><span class="nf">.insert</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="k">true</span><span class="p">);</span>
        <span class="n">visited_other_santas</span><span class="nf">.insert</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="k">true</span><span class="p">);</span>

        <span class="k">for</span> <span class="n">c</span> <span class="k">in</span> <span class="n">input_string</span><span class="nf">.chars</span><span class="p">()</span> <span class="p">{</span> 
            <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'^'</span><span class="p">){</span>
                <span class="n">santa_1_x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">santa_2_x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">santa_3_x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'v'</span><span class="p">){</span>
                <span class="n">santa_1_x</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">santa_2_x</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">santa_3_x</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'&gt;'</span><span class="p">){</span>
                <span class="n">santa_1_y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">santa_2_y</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">santa_3_y</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'&lt;'</span><span class="p">){</span>
                <span class="n">santa_1_y</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">santa_2_y</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">santa_3_y</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>
            
            <span class="n">visited_santa_1</span><span class="nf">.insert</span><span class="p">((</span><span class="n">santa_1_x</span><span class="p">,</span> <span class="n">santa_1_y</span><span class="p">),</span> <span class="k">true</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                <span class="n">visited_other_santas</span><span class="nf">.entry</span><span class="p">((</span><span class="n">santa_2_x</span><span class="p">,</span> <span class="n">santa_2_y</span><span class="p">))</span><span class="nf">.or_insert</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="n">visited_other_santas</span><span class="nf">.entry</span><span class="p">((</span><span class="n">santa_3_x</span><span class="p">,</span> <span class="n">santa_3_y</span><span class="p">))</span><span class="nf">.or_insert</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">curr_turn</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">visited_santa_1</span><span class="nf">.keys</span><span class="p">()</span><span class="nf">.len</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">visited_other_santas</span><span class="nf">.keys</span><span class="p">()</span><span class="nf">.len</span><span class="p">();</span>
        <span class="nd">print!</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> day 1: {}"</span><span class="p">,</span> <span class="n">p1</span><span class="p">);</span>
        <span class="nd">print!</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> day 2: {}"</span><span class="p">,</span> <span class="n">p2</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">end</span> <span class="o">=</span> <span class="n">start</span><span class="nf">.elapsed</span><span class="p">()</span><span class="nf">.as_micros</span><span class="p">();</span>
        <span class="nd">print!</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> execution time in microseconds {}"</span><span class="p">,</span> <span class="n">end</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Our run time is something like 698 microseconds, which is pretty good. But we can do better.</p><p>A small immediate improvement that comes to mind is not doing <code class="language-plaintext highlighter-rouge">keys.len</code> at the end, since that’s essentially iterating over the existing dict. Instead we can check if the key is in use when we go to write, and if it is not, we increment our counter by 1. Something like this:</p><h2 id="counter-vs-keyslen">Counter vs. Keys.len</h2><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">time</span><span class="p">::{</span><span class="n">Instant</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">fs</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::</span><span class="n">HashMap</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::</span><span class="nn">hash_map</span><span class="p">::</span><span class="n">Entry</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">(){</span>
       
        <span class="k">let</span> <span class="n">file</span> <span class="o">=</span><span class="s">"../input.txt"</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">input_string</span><span class="p">:</span> <span class="nb">String</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">start</span> <span class="o">=</span> <span class="nn">Instant</span><span class="p">::</span><span class="nf">now</span><span class="p">();</span>
  
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_1_x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_2_x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_3_x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_1_y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_2_y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_3_y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">curr_turn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">visited_santa_1</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">visited_other_santas</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

        <span class="n">visited_santa_1</span><span class="nf">.insert</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="k">true</span><span class="p">);</span>
        <span class="n">visited_other_santas</span><span class="nf">.insert</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="k">true</span><span class="p">);</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">p1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">p2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">for</span> <span class="n">c</span> <span class="k">in</span> <span class="n">input_string</span><span class="nf">.chars</span><span class="p">()</span> <span class="p">{</span> 
            <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'^'</span><span class="p">){</span>
                <span class="n">santa_1_x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">santa_2_x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">santa_3_x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'v'</span><span class="p">){</span>
                <span class="n">santa_1_x</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">santa_2_x</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">santa_3_x</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'&gt;'</span><span class="p">){</span>
                <span class="n">santa_1_y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">santa_2_y</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">santa_3_y</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'&lt;'</span><span class="p">){</span>
                <span class="n">santa_1_y</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">santa_2_y</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">santa_3_y</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>
            
            <span class="k">match</span> <span class="n">visited_santa_1</span><span class="nf">.entry</span><span class="p">((</span><span class="n">santa_1_x</span><span class="p">,</span> <span class="n">santa_1_y</span><span class="p">))</span> <span class="p">{</span>
                <span class="nn">Entry</span><span class="p">::</span><span class="nf">Occupied</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">(),</span>
                <span class="nn">Entry</span><span class="p">::</span><span class="nf">Vacant</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                                    <span class="n">v</span><span class="nf">.insert</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
                                    <span class="n">p1</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                <span class="k">match</span> <span class="n">visited_other_santas</span><span class="nf">.entry</span><span class="p">((</span><span class="n">santa_2_x</span><span class="p">,</span> <span class="n">santa_2_y</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nn">Entry</span><span class="p">::</span><span class="nf">Occupied</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">(),</span>
                    <span class="nn">Entry</span><span class="p">::</span><span class="nf">Vacant</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                                        <span class="n">v</span><span class="nf">.insert</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
                                        <span class="n">p2</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="p">}</span>
                <span class="p">};</span>
                <span class="k">match</span> <span class="n">visited_other_santas</span><span class="nf">.entry</span><span class="p">((</span><span class="n">santa_3_x</span><span class="p">,</span> <span class="n">santa_3_y</span><span class="p">)){</span>
                    <span class="nn">Entry</span><span class="p">::</span><span class="nf">Occupied</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">(),</span>
                    <span class="nn">Entry</span><span class="p">::</span><span class="nf">Vacant</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                                        <span class="n">v</span><span class="nf">.insert</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
                                        <span class="n">p2</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="p">}</span>
                <span class="p">};</span>
            <span class="p">}</span>
            <span class="n">curr_turn</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nd">print!</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> day 1: {}"</span><span class="p">,</span> <span class="n">p1</span><span class="p">);</span>
        <span class="nd">print!</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> day 2: {}"</span><span class="p">,</span> <span class="n">p2</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">end</span> <span class="o">=</span> <span class="n">start</span><span class="nf">.elapsed</span><span class="p">()</span><span class="nf">.as_micros</span><span class="p">();</span>
        <span class="nd">print!</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> execution time in microseconds {}"</span><span class="p">,</span> <span class="n">end</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Which gives us a runtime of… 670 microseconds. A 20 microsecond improvement. Not as good as we’d like, but not terrible. Iterating over the map in memory was obviously not that time consuming.</p><p>Lets examine the problem-space and see if we can come up with any more ideas.</p><p>For one, we know we’re dealing with a fixed dataset that has a maximum number of 8192 moves. This means our physical grid is really no larger than 8192x8192, even assuming all the moves are in one direction. The movement is also not random. Mapping out the moves we get an image that looks like this:</p><p><a href="/assets/img/Rust_AoC_2015_Day_3_2_RandomWalk.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/Rust_AoC_2015_Day_3_2_RandomWalk.png" alt="Click to view larger image" /></a></p><p>This is <em>not</em> a random walking path. Generally walking paths in small iterations cluster around a central node, and migrate slightly from side to side as a new random center is determined. If there were a flat 25% chance of going a specific direction, we would have a much tighter knot, and none of these long spawning paths going off into the distance. If this were a much broader dataset, we could consider doing some kind of memoization of move patterns, or limited compression… but we only have 8000ish moves. Which makes that unlikely to be fruitful. In fact, the more I considered optimizations, the more i realized, there’s no way to avoid scanning the memory space once, and doing it more than once is probably inefficient. I had however, one last idea. What if we could improve on the map? I considered a <a href="https://en.wikipedia.org/wiki/Trie">Trie</a>, but the insertion time seemed generally worse or equal to a map. Since we only had 2000ish dict entries, we are probably not running into a lot of bucket rebalancing.</p><p>Alright, fine, what if we used an Array? Instead of having a tuple key, we could turn the coordinate tuple into an integer key, access the array directly by index (O(1)) and writing directly (O(1)). Sure our array would have to be big. Massive in fact to make it work, but memory is not a real concern. Arrays aren’t <em>meant</em> to be used as HashMap substitutes, but maybe it’ll be faster than our match statements?</p><h2 id="preallocated-array">Preallocated Array</h2><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">time</span><span class="p">::{</span><span class="n">Instant</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">fs</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">(){</span>
       
        <span class="k">let</span> <span class="n">file</span> <span class="o">=</span><span class="s">"../input.txt"</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">input_string</span><span class="p">:</span> <span class="nb">String</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">start</span> <span class="o">=</span> <span class="nn">Instant</span><span class="p">::</span><span class="nf">now</span><span class="p">();</span>
  
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_1_x</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_2_x</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_3_x</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_1_y</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_2_y</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_3_y</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">;</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">curr_turn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>


        <span class="k">let</span> <span class="k">mut</span> <span class="n">visited_santa_1</span><span class="p">:</span> <span class="p">[</span><span class="nb">u8</span><span class="p">;</span> <span class="mi">8000</span><span class="o">*</span><span class="mi">8000</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span> <span class="mi">8000</span><span class="o">*</span><span class="mi">8000</span><span class="p">];</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">visited_other_santas</span><span class="p">:</span> <span class="p">[</span><span class="nb">u8</span><span class="p">;</span> <span class="mi">8000</span><span class="o">*</span><span class="mi">8000</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span> <span class="mi">8000</span><span class="o">*</span><span class="mi">8000</span><span class="p">];</span>

        <span class="n">visited_santa_1</span><span class="p">[</span><span class="n">santa_1_x</span><span class="o">*</span><span class="mi">8000</span> <span class="o">+</span> <span class="n">santa_1_y</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">visited_other_santas</span><span class="p">[</span><span class="n">santa_2_x</span><span class="o">*</span><span class="mi">8000</span> <span class="o">+</span> <span class="n">santa_2_y</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">p1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">p2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="k">for</span> <span class="n">c</span> <span class="k">in</span> <span class="n">input_string</span><span class="nf">.chars</span><span class="p">()</span> <span class="p">{</span> 
            <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'^'</span><span class="p">){</span>
                <span class="n">santa_1_x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">santa_2_x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">santa_3_x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'v'</span><span class="p">){</span>
                <span class="n">santa_1_x</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">santa_2_x</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">santa_3_x</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'&gt;'</span><span class="p">){</span>
                <span class="n">santa_1_y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">santa_2_y</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">santa_3_y</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'&lt;'</span><span class="p">){</span>
                <span class="n">santa_1_y</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">santa_2_y</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">santa_3_y</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">visited_santa_1</span><span class="p">[</span><span class="n">santa_1_x</span><span class="o">*</span><span class="mi">8000</span> <span class="o">+</span> <span class="n">santa_1_y</span> <span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">{</span>
                <span class="n">visited_santa_1</span><span class="p">[</span><span class="n">santa_1_x</span><span class="o">*</span><span class="mi">8000</span> <span class="o">+</span> <span class="n">santa_1_y</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">p1</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
            
            <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                <span class="k">if</span> <span class="n">visited_other_santas</span><span class="p">[</span><span class="n">santa_2_x</span><span class="o">*</span><span class="mi">8000</span> <span class="o">+</span> <span class="n">santa_2_y</span> <span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">{</span>
                    <span class="n">visited_other_santas</span><span class="p">[</span><span class="n">santa_2_x</span><span class="o">*</span><span class="mi">8000</span> <span class="o">+</span> <span class="n">santa_2_y</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="n">p2</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">if</span> <span class="n">visited_other_santas</span><span class="p">[</span><span class="n">santa_3_x</span><span class="o">*</span><span class="mi">8000</span> <span class="o">+</span> <span class="n">santa_3_y</span> <span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">{</span>
                    <span class="n">visited_other_santas</span><span class="p">[</span><span class="n">santa_3_x</span><span class="o">*</span><span class="mi">8000</span> <span class="o">+</span> <span class="n">santa_3_y</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="n">p2</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">curr_turn</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nd">print!</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> day 1: {}"</span><span class="p">,</span> <span class="n">p1</span><span class="p">);</span>
        <span class="nd">print!</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> day 2: {}"</span><span class="p">,</span> <span class="n">p2</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">end</span> <span class="o">=</span> <span class="n">start</span><span class="nf">.elapsed</span><span class="p">()</span><span class="nf">.as_micros</span><span class="p">();</span>
        <span class="nd">print!</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> execution time in microseconds {}"</span><span class="p">,</span> <span class="n">end</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Some arrays, set to be 64000000 entries in size. That’s 64 million. We’ll populate it all with zeroes, and it will be principally full of zeroes. Our poor mans hashing algorithm to index into the array will be 8000(x_coord) + y+coord, and we’ll move our coordinate space so all values inside it are positive. (Roughly, we should have built a bigger space to make <em>sure</em> we weren’t dipping into the negatives, but being an initial test, this will do.</p><p><code class="language-plaintext highlighter-rouge">thread 'main' has overflowed its stack</code></p><p>Alright, we did it. We can pack up and go home. I beat Dave to the error of errors.</p><p>Arrays in rust are contiguous in memory, and we asked a little too much from our available memory space. Theoretically we should be using the rust <a href="https://doc.rust-lang.org/std/boxed/struct.Box.html">Box</a> to allocate our memory into the heap instead. Or we could try using a Vec. A Vec is <em>like</em> an array, but it allocates its memory in the heap instead of the stack and it’s not of fixed size. (If “heap” and “stack” are mystery words to you, I highly recommend <a href="https://doc.rust-lang.org/1.22.0/book/first-edition/the-stack-and-the-heap.html">this bit</a> of the rust book) That’s all a bunch of overhead I wanted to skip, but it looks like there’s no getting around it. Lets try it with a vector.</p><h2 id="preallocated-vectors">Preallocated Vectors</h2><div class="language-rust highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">time</span><span class="p">::{</span><span class="n">Instant</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">fs</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">(){</span>
       
        <span class="k">let</span> <span class="n">file</span> <span class="o">=</span><span class="s">"../input.txt"</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">input_string</span><span class="p">:</span> <span class="nb">String</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">start</span> <span class="o">=</span> <span class="nn">Instant</span><span class="p">::</span><span class="nf">now</span><span class="p">();</span>
  
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_1_x</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_2_x</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_3_x</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_1_y</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_2_y</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">santa_3_y</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">;</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">curr_turn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>


        <span class="k">let</span> <span class="k">mut</span> <span class="n">visited_santa_1</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span> <span class="mi">8000</span><span class="o">*</span><span class="mi">8000</span><span class="p">];</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">visited_other_santas</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span> <span class="mi">8000</span><span class="o">*</span><span class="mi">8000</span><span class="p">];</span>

        <span class="n">visited_santa_1</span><span class="p">[</span><span class="n">santa_1_x</span><span class="o">*</span><span class="mi">8000</span> <span class="o">+</span> <span class="n">santa_1_y</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">visited_other_santas</span><span class="p">[</span><span class="n">santa_2_x</span><span class="o">*</span><span class="mi">8000</span> <span class="o">+</span> <span class="n">santa_2_y</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">p1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">p2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="k">for</span> <span class="n">c</span> <span class="k">in</span> <span class="n">input_string</span><span class="nf">.chars</span><span class="p">()</span> <span class="p">{</span> 
            <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'^'</span><span class="p">){</span>
                <span class="n">santa_1_x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">santa_2_x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">santa_3_x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'v'</span><span class="p">){</span>
                <span class="n">santa_1_x</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">santa_2_x</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">santa_3_x</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'&gt;'</span><span class="p">){</span>
                <span class="n">santa_1_y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">santa_2_y</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">santa_3_y</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'&lt;'</span><span class="p">){</span>
                <span class="n">santa_1_y</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">santa_2_y</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="n">santa_3_y</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">visited_santa_1</span><span class="p">[</span><span class="n">santa_1_x</span><span class="o">*</span><span class="mi">8000</span> <span class="o">+</span> <span class="n">santa_1_y</span> <span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">{</span>
                <span class="n">visited_santa_1</span><span class="p">[</span><span class="n">santa_1_x</span><span class="o">*</span><span class="mi">8000</span> <span class="o">+</span> <span class="n">santa_1_y</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">p1</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
            
            <span class="k">if</span><span class="p">(</span><span class="n">curr_turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                <span class="k">if</span> <span class="n">visited_other_santas</span><span class="p">[</span><span class="n">santa_2_x</span><span class="o">*</span><span class="mi">8000</span> <span class="o">+</span> <span class="n">santa_2_y</span> <span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">{</span>
                    <span class="n">visited_other_santas</span><span class="p">[</span><span class="n">santa_2_x</span><span class="o">*</span><span class="mi">8000</span> <span class="o">+</span> <span class="n">santa_2_y</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="n">p2</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">if</span> <span class="n">visited_other_santas</span><span class="p">[</span><span class="n">santa_3_x</span><span class="o">*</span><span class="mi">8000</span> <span class="o">+</span> <span class="n">santa_3_y</span> <span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">{</span>
                    <span class="n">visited_other_santas</span><span class="p">[</span><span class="n">santa_3_x</span><span class="o">*</span><span class="mi">8000</span> <span class="o">+</span> <span class="n">santa_3_y</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="n">p2</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">curr_turn</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nd">print!</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> day 1: {}"</span><span class="p">,</span> <span class="n">p1</span><span class="p">);</span>
        <span class="nd">print!</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> day 2: {}"</span><span class="p">,</span> <span class="n">p2</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">end</span> <span class="o">=</span> <span class="n">start</span><span class="nf">.elapsed</span><span class="p">()</span><span class="nf">.as_micros</span><span class="p">();</span>
        <span class="nd">print!</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> execution time in microseconds {}"</span><span class="p">,</span> <span class="n">end</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This does not crash, but the results are disappointing. Our massive fixed size vector is worst than a map (which we kind of expected). The runtime for this is about 1000 microseconds, 300 more than our first solution. Unsurprisingly, almost 770 of those microseconds are in initializing the vecors. If we compare the runtime not counting the time it takes to creat the vectors, the vector solution is actually almost 400 microseconds faster (we also skipped initalizating the HashMaps for fairness)!</p><p>What does this mean? If we had a fixed dimension for the Santa traveling, and a much larger dataset, then it seems likely the array based solution would be <em>faster</em>. Its a reminder to always consider what your problem space actually is, and analyze the specific data you’re working with, since that will dictate what solutions work best. Everything is a tradeoff, and when you’re chasing speed (as we are), you can make other tradeoffs (like making sacrifices in memory)</p><p>Join us next time while we try to do things in parallel.</p></div><div class="post-content"><h3>Series</h3><li><a href="/posts/advent-of-code-2015-rust-day-1/">Learning Rust with Advent of Code - Day 1</a><li><a href="/posts/advent-of-code-2015-rust-day-2/">Learning Rust with Advent of Code - Day 2</a><li><b>Learning Rust with Advent of Code - Day 3</b><li><a href="/posts/advent-of-code-2015-rust-day-4/">Learning Rust with Advent of Code - Day 4</a><li><a href="/posts/advent-of-code-2015-rust-day-5/">Learning Rust with Advent of Code - Day 5</a><li><a href="/posts/advent-of-code-2015-rust-day-6/">Learning Rust with Advent of Code - Day 6</a></div><hr><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/programming/'>Programming</a>, <a href='/categories/advent-of-code/'>Advent of Code</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/programming/" class="post-tag no-text-decoration" >programming</a> <a href="/tags/rust/" class="post-tag no-text-decoration" >rust</a> <a href="/tags/david/" class="post-tag no-text-decoration" >david</a> <a href="/tags/felipe/" class="post-tag no-text-decoration" >felipe</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Learning Rust with Advent of Code - Day 3 - Hall of Impossible Dreams&url=http://hallofdreams.org/posts/advent-of-code-2015-rust-day-3/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Learning Rust with Advent of Code - Day 3 - Hall of Impossible Dreams&u=http://hallofdreams.org/posts/advent-of-code-2015-rust-day-3/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Learning Rust with Advent of Code - Day 3 - Hall of Impossible Dreams&url=http://hallofdreams.org/posts/advent-of-code-2015-rust-day-3/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://giscus.app">giscus</a>.</p></div><script src="https://giscus.app/client.js" data-repo="thecog19/blog-comments-giscus" data-repo-id="R_kgDOH0cdtg" data-category="Announcements" data-category-id="DIC_kwDOH0cdts4CQ02w" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="preferred_color_scheme" data-lang="en" data-loading="lazy" crossorigin="anonymous" async> </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/thecog19">Dave and Felipe</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/david/">david</a> <a class="post-tag" href="/tags/felipe/">felipe</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/fiction/">fiction</a> <a class="post-tag" href="/tags/rust/">rust</a> <a class="post-tag" href="/tags/writing-prompts/">writing prompts</a> <a class="post-tag" href="/tags/poetry/">poetry</a> <a class="post-tag" href="/tags/essay/">essay</a> <a class="post-tag" href="/tags/mathematica/">mathematica</a> <a class="post-tag" href="/tags/hatetris/">hatetris</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="http://hallofdreams.org{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script> <script async src="https://www.googletagmanager.com/gtag/js?id=183607258"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '183607258'); </script>
